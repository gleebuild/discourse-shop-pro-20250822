<div class="shop-admin">
  <h2>{{i18n "discourse_shop.admin.title"}}</h2>

  <div class="admin-panels">
    <div class="panel">
      <h3>{{i18n "discourse_shop.admin.products"}}</h3>

      <div class="create-form">
        <h4>{{i18n "discourse_shop.admin.new_product"}}</h4>
        <label>名称 <input {{on "input" (fn this.setNewP "name")}}></label>
        <label>价格（分） <input type="number" {{on "input" (fn this.setNewP "price_cents")}}></label>
        <label>货币 <input value="CNY" {{on "input" (fn this.setNewP "currency")}}></label>
        <label>主图URL <input {{on "input" (fn this.setNewP "image")}}></label>
        <button class="btn" {{on "click" this.createProduct}}>创建</button>
      </div>

      <div class="actions">
        <label>关键词 <input {{on "input" (fn this.setKw)}}></label>
        <label>状态
          <select {{on "change" (fn this.setStatus)}}>
            <option value="">全部</option>
            <option value="active">上架</option>
            <option value="draft">草稿</option>
            <option value="archived">下架</option>
          </select>
        </label>
        <button class="btn" {{on "click" this.loadProducts}}>刷新</button>
      </div>
      <table class="table">
        <thead><tr><th>ID</th><th>名称</th><th>价格</th><th>状态</th><th>操作</th></tr></thead>
        <tbody>
          {{#each this.products as |p|}}
            <tr>
              <td>{{p.id}}</td>
              <td>{{p.name}}</td>
              <td>{{format-number p.price_cents style="currency" currency=p.currency}}</td>
              <td>{{p.status}}</td>
              <td>
                <button class="btn" {{on "click" (fn this.setStatusFor p "active")}}>上架</button>
                <button class="btn" {{on "click" (fn this.setStatusFor p "archived")}}>下架</button>
              </td>
            </tr>
          {{/each}}
        </tbody>
      </table>
    </div>

    <div class="panel">
      <h3>{{i18n "discourse_shop.admin.coupons"}}</h3>

      <div class="create-form">
        <h4>{{i18n "discourse_shop.admin.new_coupon"}}</h4>
        <label>码 <input {{on "input" (fn this.setNewC "code")}}></label>
        <label>类型
          <select {{on "change" (fn this.setNewC "discount_type")}}>
            <option value="percent">折扣百分比</option>
            <option value="amount">固定金额（分）</option>
          </select>
        </label>
        <label>值 <input type="number" {{on "input" (fn this.setNewC "value")}}></label>
        <button class="btn" {{on "click" this.createCoupon}}>创建</button>
      </div>

      <div class="actions">
        <label>关键词 <input {{on "input" (fn this.setKwCoupon)}}></label>
        <button class="btn" {{on "click" this.loadCoupons}}>刷新</button>
      </div>
      <table class="table">
        <thead><tr><th>ID</th><th>码</th><th>类型</th><th>值</th><th>状态</th></tr></thead>
        <tbody>
          {{#each this.coupons as |c|}}
            <tr><td>{{c.id}}</td><td>{{c.code}}</td><td>{{c.discount_type}}</td><td>{{c.value}}</td><td>{{c.status}}</td></tr>
          {{/each}}
        </tbody>
      </table>
    </div>

    <div class="panel">
      <h3>{{i18n "discourse_shop.admin.orders"}}</h3>
      <div class="actions">
        <label>关键词 <input {{on "input" (fn this.setKwOrder)}}></label>
        <label>状态
          <select {{on "change" (fn this.setOrderStatus)}}>
            <option value="">全部</option>
            <option value="created">创建</option>
            <option value="paying">支付中</option>
            <option value="paid">已支付</option>
            <option value="fulfilled">已发货</option>
          </select>
        </label>
        <button class="btn" {{on "click" this.loadOrders}}>刷新</button>
      </div>
      <table class="table">
        <thead><tr><th>ID</th><th>状态</th><th>金额</th><th>支付方式</th><th>发货</th></tr></thead>
        <tbody>
          {{#each this.orders as |o|}}
            <tr>
              <td>{{o.id}}</td>
              <td>{{o.status}}</td>
              <td>{{format-number o.total_cents style="currency" currency=o.currency}}</td>
              <td>{{o.payment_method}}</td>
              <td>
                <label>公司 <input {{on "input" (fn this.setShipField o "company")}}></label>
                <label>单号 <input {{on "input" (fn this.setShipField o "tracking_no")}}></label>
                <button class="btn" {{on "click" (fn this.fulfill o)}}>保存发货</button>
              </td>
            </tr>
          {{/each}}
        </tbody>
      </table>
    </div>
  </div>
</div>
